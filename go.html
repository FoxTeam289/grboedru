<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Грибоед - пойти в лес</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <link rel="shortcut icon" href="icon.png" type="image/x-icon">
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }
        header {
            background-color: #4CAF50;
            color: white;
            padding: 10px;
            text-align: center;
        }
        main {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        #map {
            flex: 1;
            width: 100%;
        }
        .controls {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            background-color: #f9f9f9;
            padding: 10px;
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: 10px;
            transition: opacity 0.3s ease;
            opacity: 1;
            visibility: visible;
        }
        .controls button,
        .controls select {
            padding: 10px;
            font-size: 14px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            flex: 1 1 45%;
            box-sizing: border-box;
            margin: 5px;
        }
        .controls button {
            background-color: #4CAF50;
            color: white;
        }
        .controls button:hover {
            background-color: #45a049;
        }
        .controls select {
            background-color: white;
            color: #333;
        }
        .controls select:focus {
            outline: none;
            border: 2px solid #4CAF50;
        }
        nav {
            background-color: #333;
            overflow: hidden;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            transition: height 0.3s ease;
            z-index: 100;
            height: 50px;
        }
        nav.show-menu {
            height: auto;
        }
        nav a {
            float: left;
            display: block;
            color: #f2f2f2;
            text-align: center;
            padding: 14px 16px;
            text-decoration: none;
            transition: transform 0.3s;
        }
        nav a:hover {
            background-color: #ddd;
            color: black;
        }
        nav a.active {
            background-color: #4CAF50;
            color: white;
        }
        .menu-button {
            display: none;
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px;
            cursor: pointer;
            z-index: 10;
            transition: transform 0.3s;
        }
        .menu-button.open {
            transform: rotate(180deg);
        }
        @media screen and (max-width: 600px) {
            nav a {
                float: none;
                width: 100%;
                text-align: left;
                transform: translateX(-100%);
            }
            .menu-button {
                display: block;
            }
            nav.show-menu a {
                transform: translateX(0);
            }
        }
        .controls.open {
            opacity: 0;
            visibility: hidden;
        }
        .controls.hidden {
            opacity: 0;
            visibility: hidden;
        }
        /* Стиль кнопки */
        button {
            background-color: #4CAF50;
            color: white;
            padding: 15px 20px;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            font-size: 16px;
        }
        button:hover {
            background-color: #45a049;
        }
        /* Модальное окно */
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s;
        }
        @keyframes fadeIn {
            from {opacity: 0;}
            to {opacity: 1;}
        }
        /* Модальное содержимое */
        .modal-content {
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            width: 400px;
            max-width: 90%;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            animation: slideIn 0.3s;
        }
        @keyframes slideIn {
            from {transform: translateY(-50px);}
            to {transform: translateY(0);}
        }
        /* Кнопка закрытия */
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close:hover,
        .close:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }
        /* Стиль формы */
        form {
            display: flex;
            flex-direction: column;
        }
        label {
            margin-bottom: 10px;
            font-weight: bold;
        }
        input[type="text"] {
            padding: 10px;
            margin-bottom: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
        }
        input[type="text"]:focus {
            border-color: #4CAF50;
        }
        form button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            font-size: 16px;
            align-self: flex-end;
        }
        form button:hover {
            background-color: #45a049;
        }
        .panorama-container {
            margin: 20px;
            padding: 10px;
            border: 1px solid #ccc;
            width: 600px;
            max-width: 100%;
        }
        .panorama-img {
            max-width: 100%;
            height: auto;
        }
    </style>
<script src="https://api-maps.yandex.ru/2.1/?apikey=86c4a0b5-0c50-44da-a0d8-a9b213634759&lang=ru_RU" type="text/javascript"></script>
</head>
<body>
			<nav class="show-menu">
				<a href="index.html">Главная</a>
				<a href="bestforest.html">Лучшие леса</a>
				<a href="otziv.html">Отзывы</a>
				<a class="active" href="go.html">Пойти в лес</a>
				<a href="documentation.html">Документация</a>
				<button class="menu-button" onclick="toggleMenu()">
					<i class="fa-solid fa-bars"></i>
				</button>
			</nav>
    <main>
        <div id="map"></div>
        <div id="control" class="controls">
            <button onclick="setUserLocation()"><i class="fas fa-map-marker-alt"></i> Поставить точку там, где я</button>
            <button id="openModalBtn" onclick="setMushroomZone()"><i class="fas fa-map-pin"></i> Поставить грибную зону</button>
            <button onclick="setUserLocation()"><i class="fas fa-location-arrow"></i> Установить мое местоположение</button>
            <select id="forestSelect" onchange="setForestLocation()"></select>
            <button onclick="searchNearbyPanoramas()"><i class="fas fa-street-view"></i> Найти ближайшие панорамы</button>
            <button id="routeBtn" onclick="navigateToCurrentLocation()"><i class="fas fa-route"></i> Построить маршрут к текущему местоположению</button>
            <button id="choose_one" style="display: none;" onclick="voteMushroomZone(true)"><i class="fas fa-thumbs-up"></i> Есть грибы</button>
            <button id="choose_two" style="display: none;" onclick="voteMushroomZone(false)"><i class="fas fa-thumbs-down"></i> Нет грибов</button>
            <button onclick="routeToForest()"><i class="fas fa-tree"></i> Маршрут к выбранному лесу</button>
            <button onclick="window.location.href='foxyprofi.itch.io/griboed'"><i class="fas fa-download"></i> Сохранить изменения</button>
            <button onclick="loadZones()"><i class="fas fa-eye"></i>Посмотреть все грибные зоны</button>
    </div>
</main>
   <!-- Модальное окно -->
   <div style="display: none;" id="myModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Введите координаты зоны</h2>
        <form id="coordinatesForm">
            <label for="latitude">Широта:</label>
            <input type="text" id="latitude" name="latitude" required>
            <label for="longitude">Долгота:</label>
            <input type="text" id="longitude" name="longitude" required>
            <button type="submit">Отправить</button>
        </form>
    </div>
</div>
  <!-- Модальное окно -->
  <div style="display: none;" id="myModal2" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal2()">x</span>
        <h2>Оценить грибную зону</h2>
        <label for="zoneName">Название зоны:</label>
        <input type="text" id="zoneName" name="zoneName" required><br><br>

        <label for="rating">Рейтинг:</label>
        <input type="number" id="rating" name="rating" min="1" max="10" required><br><br>

        <button onclick="sendZoneRating()">Отправить оценку</button>
    </div>
</div>

<script>
    // Функция для открытия модального окна
    function openModal2() {
        document.getElementById('myModal2').style.display = 'block';
    }

    // Функция для закрытия модального окна
    function closeModal2() {
        document.getElementById('myModal2').style.display = 'none';
    }

    // Функция для отправки оценки в Telegram
    function sendZoneRating() {
        const zoneName = document.getElementById('zoneName').value;
        const rating = document.getElementById('rating').value;

        // Замените 'YOUR_BOT_TOKEN' на актуальный токен вашего Telegram бота
        const botToken = '7307900933:AAFZWNxqLsJvCmCAJxjVehQU9C9jMI1k78w';
        // Замените 'YOUR_CHAT_ID' на chat_id, куда нужно отправлять сообщения
        const chatId = '7208967084';

        // URL для отправки сообщения через сервис, поддерживающий CORS (например, CORS Anywhere)
        const proxyUrl = 'https://cors-anywhere.herokuapp.com/';
        const telegramApiUrl = `https://api.telegram.org/bot${botToken}/sendMessage`;

        // Текст сообщения для отправки
        const messageText = `Оценка грибной зоны:\n${zoneName}\nРейтинг: ${rating}`;

        // Данные для отправки POST запроса
        const data = {
            chat_id: chatId,
            text: messageText
        };

        // Опции для fetch запроса
        const options = {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
        };

        // Отправка POST запроса к API Telegram через сервис, поддерживающий CORS
        fetch(proxyUrl + telegramApiUrl, options)
            .then(response => response.json())
            .then(data => {
                console.log('Message sent successfully:', data);
                alert('Оценка успешно отправлена!');
                closeModal(); // Закрыть модальное окно после успешной отправки
            })
            .catch(error => {
                console.error('Error sending message:', error);
                alert('Произошла ошибка при отправке оценки.');
                closeModal(); // Закрыть модальное окно при ошибке
            });
    }
</script>

<script>
    // Получаем модальное окно
    var modal = document.getElementById("myModal");

    // Получаем кнопку, которая открывает модальное окно
    var btn = document.getElementById("openModalBtn");

    // Получаем элемент <span>, который закрывает модальное окно
    var span = document.getElementsByClassName("close")[0];

    // Когда пользователь нажимает на кнопку, открываем модальное окно
    btn.onclick = function() {
        modal.style.display = "flex";
    }

    // Когда пользователь нажимает на <span> (x), закрываем модальное окно
    span.onclick = function() {
        modal.style.display = "none";
    }

    // Когда пользователь нажимает в любом месте за пределами модального окна, закрываем его
    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }

    // Обрабатываем отправку формы
    document.getElementById("coordinatesForm").onsubmit = function(event) {
        event.preventDefault();
        var latitude = document.getElementById("latitude").value;
        var longitude = document.getElementById("longitude").value;
        sendCoordinatesToTelegram([latitude, longitude]);
        modal.style.display = "none";
    }

    async function sendCoordinatesToTelegram(coords) {
        const telegramToken = '7307900933:AAFZWNxqLsJvCmCAJxjVehQU9C9jMI1k78w';
        const chatId = '7208967084';
        const message = `Грибная зона (На модерации)\nШирота: ${coords[0]}\nДолгота: ${coords[1]}`;

        const telegramUrl = `https://api.telegram.org/bot${telegramToken}/sendMessage`;

        try {
            const response = await fetch(telegramUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    chat_id: chatId,
                    text: message
                })
            });

            if (!response.ok) {
                throw new Error('Network response was not ok');
            }

            const data = await response.json();
            console.log('Zone sent to Telegram:', data);
        } catch (error) {
            console.error('Error:', error);
        }
    }
</script>
<script>


    var map, userPlacemark, mushroomZonePlacemark, forestPlacemark, targetPlacemark, multiRoute;
     // Данные лесов
     var forests = [
    { name: 'Борщевский лес', coords: [55.756, 37.617], rating: 7, mushrooms: ['Подберезовик', 'Белый гриб', 'Рыжик', 'Лисичка'] },
    { name: 'Подмосковный лес', coords: [55.751, 37.618], rating: 8, mushrooms: ['Белый гриб', 'Подберезовик', 'Масленок', 'Лисичка'] },
    { name: 'Лес в районе Новорижского шоссе', coords: [55.695, 37.534], rating: 6, mushrooms: ['Подберезовик', 'Масленок', 'Рыжик'] },
    { name: 'Лесной массив "Измайлово"', coords: [55.793, 37.814], rating: 7, mushrooms: ['Подосиновик', 'Подберезовик', 'Опята'] },
    { name: 'Битцевский лес', coords: [55.634, 37.576], rating: 7, mushrooms: ['Масленок', 'Подберезовик', 'Лисичка'] },
    { name: 'Лосиновский лес', coords: [55.647, 37.541], rating: 6, mushrooms: ['Рыжик', 'Белый гриб', 'Масленок'] },
    { name: 'Лес в районе Клязьминского водохранилища', coords: [55.902, 37.562], rating: 8, mushrooms: ['Белый гриб', 'Лисичка', 'Подосиновик'] },
    { name: 'Лес в районе Волжского водохранилища', coords: [55.717, 49.213], rating: 5, mushrooms: ['Масленок', 'Подосиновик'] },
    { name: 'Лес в районе Озера Селигер', coords: [57.053, 33.263], rating: 9, mushrooms: ['Белый гриб', 'Лисичка', 'Подосиновик', 'Рыжик'] },
    { name: 'Лес в районе Зеленограда', coords: [55.994, 37.214], rating: 7, mushrooms: ['Подберезовик', 'Масленок'] },
    { name: 'Лес в районе Пушкино', coords: [56.017, 37.847], rating: 8, mushrooms: ['Белый гриб', 'Лисичка', 'Подосиновик'] },
    { name: 'Лес в районе Мытищ', coords: [55.910, 37.736], rating: 7, mushrooms: ['Подосиновик', 'Масленок'] },
    { name: 'Лес в районе Черноголовки', coords: [56.010, 38.379], rating: 7, mushrooms: ['Белый гриб', 'Подберезовик'] },
    { name: 'Лес в районе Шатуры', coords: [55.574, 39.539], rating: 6, mushrooms: ['Масленок', 'Подосиновик'] },
    { name: 'Лес в районе Сергиева Посада', coords: [56.306, 38.130], rating: 8, mushrooms: ['Белый гриб', 'Лисичка', 'Подосиновик'] },
    { name: 'Лес в районе Раменского', coords: [55.573, 38.226], rating: 7, mushrooms: ['Масленок', 'Подберезовик'] },
    { name: 'Лес в районе Воскресенска', coords: [55.312, 38.645], rating: 6, mushrooms: ['Рыжик', 'Масленок'] },
    { name: 'Лес в районе Люберец', coords: [55.681, 37.898], rating: 6, mushrooms: ['Подберезовик', 'Рыжик'] },
    { name: 'Лес в районе Подольска', coords: [55.436, 37.568], rating: 7, mushrooms: ['Масленок', 'Лисичка'] },
    { name: 'Лес в районе Троицка', coords: [55.471, 37.305], rating: 6, mushrooms: ['Рыжик', 'Подосиновик'] },
    { name: 'Лес в районе Домодедово', coords: [55.441, 37.747], rating: 7, mushrooms: ['Белый гриб', 'Масленок'] },
    { name: 'Лес в районе Наро-Фоминска', coords: [55.378, 36.740], rating: 8, mushrooms: ['Белый гриб', 'Подосиновик', 'Лисичка'] },
    { name: 'Лес в районе Обнинска', coords: [55.089, 36.615], rating: 7, mushrooms: ['Подберезовик', 'Масленок'] },
    { name: 'Лес в районе Балабаново', coords: [55.178, 36.677], rating: 6, mushrooms: ['Рыжик', 'Подосиновик'] },
    { name: "Белицкий лес", coords: [52.967, 27.553], rating: 7, mushrooms: ['Подосиновик', 'Масленок'] },
    { name: "Березинский биосферный заповедник", coords: [54.625, 28.233], rating: 8, mushrooms: ['Белый гриб', 'Лисичка', 'Подосиновик'] },
    { name: "Национальный парк 'Беловежская пуща'", coords: [52.731, 23.834], rating: 9, mushrooms: ['Белый гриб', 'Рыжик', 'Лисичка'] },
    { name: "Налибокская пуща", coords: [54.082, 26.535], rating: 7, mushrooms: ['Подосиновик', 'Масленок'] },
    { name: "Национальный парк 'Припятский'", coords: [52.213, 27.334], rating: 8, mushrooms: ['Белый гриб', 'Лисичка', 'Подосиновик'] },
    { name: "Рудский лес", coords: [54.150, 27.922], rating: 7, mushrooms: ['Масленок', 'Подберезовик'] },
    { name: "Озерский лес", coords: [53.400, 26.150], rating: 6, mushrooms: ['Рыжик', 'Масленок'] },
    { name: "Национальный парк 'Браславские озера'", coords: [55.633, 27.033], rating: 9, mushrooms: ['Белый гриб', 'Подосиновик', 'Лисичка'] },
    { name: "Шарковщинский лес", coords: [54.733, 26.400], rating: 7, mushrooms: ['Масленок', 'Подберезовик'] },
    { name: "Червенский лес", coords: [53.700, 28.400], rating: 6, mushrooms: ['Рыжик', 'Масленок'] },
    { name: 'Кременские леса', coords: [49.0848, 33.4204], rating: 7, mushrooms: ['Подосиновик', 'Масленок'] },
    { name: 'Национальный природный парк "Сколевские Бескиды"', coords: [48.8667, 23.4667], rating: 9, mushrooms: ['Белый гриб', 'Лисичка', 'Подосиновик'] },
    { name: 'Леса Полтавской области', coords: [49.5883, 34.5514], rating: 8, mushrooms: ['Белый гриб', 'Масленок', 'Подберезовик'] },
    { name: 'Леса Львовской области', coords: [49.8397, 24.0297], rating: 8, mushrooms: ['Подосиновик', 'Лисичка'] },
    { name: 'Леса Закарпатской области', coords: [48.6208, 22.2879], rating: 8, mushrooms: ['Белый гриб', 'Подосиновик'] },
    { name: 'Леса Житомирской области', coords: [50.2547, 28.6587], rating: 7, mushrooms: ['Масленок', 'Подберезовик'] },
    { name: 'Леса Волынской области', coords: [50.7472, 25.3257], rating: 7, mushrooms: ['Подосиновик', 'Рыжик'] },
    { name: 'Леса Черниговской области', coords: [51.4914, 31.3027], rating: 7, mushrooms: ['Масленок', 'Лисичка'] },
    { name: 'Леса Харьковской области', coords: [49.9935, 36.2304], rating: 7, mushrooms: ['Подосиновик', 'Масленок'] },
    { name: 'Леса Винницкой области', coords: [49.2331, 28.4682], rating: 8, mushrooms: ['Белый гриб', 'Подберезовик'] },
    { name: 'Леса Ровенской области', coords: [50.6199, 26.2516], rating: 8, mushrooms: ['Подосиновик', 'Лисичка'] },
    { name: 'Леса Киевской области', coords: [50.4501, 30.5234], rating: 8, mushrooms: ['Белый гриб', 'Лисичка', 'Масленок'] },
    { name: 'Леса Черкасской области', coords: [49.4444, 32.0598], rating: 7, mushrooms: ['Масленок', 'Подберезовик'] },
    { name: 'Американский национальный лес', coords: [40.7128, -74.0060], rating: 9, mushrooms: ['Морелла', 'Chanterelle', 'Lobster mushroom'] },
    { name: 'Yellowstone National Park Forest', coords: [44.4280, -110.5885], rating: 8, mushrooms: ['Morel', 'Bolete', 'Chanterelle'] }
];

var mushroomZones = [
    {
        "name": "Боровые леса Подмосковья",
        "latitude": 55.500,
        "longitude": 37.000,
        "review": 8.0
    },
    {
        "name": "Леса Карелии",
        "latitude": 62.000,
        "longitude": 32.000,
        "review": 8.0
    },
    {
        "name": "Тайга Красноярского края",
        "latitude": 56.010,
        "longitude": 92.872,
        "review": 8.5
    },
    {
        "name": "Леса Алтая",
        "latitude": 51.475,
        "longitude": 85.008,
        "review": 8.0
    },
    {
        "name": "Леса Ханты-Мансийского автономного округа",
        "latitude": 60.000,
        "longitude": 70.000,
        "review": 8.0
    },
    {
        "name": "Тайга на Камчатке",
        "latitude": 56.132,
        "longitude": 158.618,
        "review": 8.5
    },
    {
        "name": "Леса Приамурья",
        "latitude": 50.000,
        "longitude": 128.000,
        "review": 7.5
    },
    {
        "name": "Леса Чукотки",
        "latitude": 66.000,
        "longitude": 170.000,
        "review": 7.0
    },
    {
        "name": "Тайга Якутии",
        "latitude": 63.000,
        "longitude": 129.000,
        "review": 7.5
    },
    {
        "name": "Бор на Саянах",
        "latitude": 53.431,
        "longitude": 91.021,
        "review": 7.0
    },
    {
        "name": "Леса Пермского края",
        "latitude": 58.000,
        "longitude": 56.000,
        "review": 7.5
    },
    {
        "name": "Грибная зона",
        "latitude": 47.735195,
        "longitude": 25.654194,
        "review": 9.5
    },
    {
        "name": "Грибная зона",
        "latitude": 47.787216,
        "longitude": 25.689701,
        "review": 9.5
    },
    {
        "name": "Грибная зона",
        "latitude": 47.799820,
        "longitude": 25.637493,
        "review": 9.5
    },
    {
        "name": "Грибная зона",
        "latitude": 55.902607,
        "longitude": 37.483002,
        "review": 9.0
    },
    {
        "name": "Минская область",
        "latitude": 53.902,
        "longitude": 27.562,
        "review": 5.0
    },
    {
        "name": "Брестская область",
        "latitude": 52.097,
        "longitude": 23.734,
        "review": 5.0
    },
    {
        "name": "Витебская область",
        "latitude": 55.184,
        "longitude": 30.204,
        "review": 5.5
    },
    {
        "name": "Могилевская область",
        "latitude": 53.894,
        "longitude": 30.331,
        "review": 5.0
    },
    {
        "name": "Гомельская область",
        "latitude": 52.434,
        "longitude": 30.975,
        "review": 5.0
    },
    {
        "name": "Гродненская область",
        "latitude": 53.688,
        "longitude": 23.825,
        "review": 5.5
    },
    {
        "name": "Киевская область, Бородянка",
        "latitude": 50.6395,
        "longitude": 29.9183,
        "review": 6.0
    },
    {
        "name": "Киевская область, Вышгород",
        "latitude": 50.5838,
        "longitude": 30.4898,
        "review": 6.0
    },
    {
        "name": "Окрестности озера Синевир",
        "latitude": 48.6222,
        "longitude": 23.6697,
        "review": 5.0
    },
    {
        "name": "Львовская область, Лумшоры",
        "latitude": 48.6345,
        "longitude": 22.9021,
        "review": 5.0
    },
    {
        "name": "Харьковская область",
        "latitude": 49.9935,
        "longitude": 36.2304,
        "review": 5.0
    },
    {
        "name": "Днепропетровская область",
        "latitude": 48.4647,
        "longitude": 35.0462,
        "review": 5.0
    },
    {
        "name": "Закарпатская область",
        "latitude": 48.6208,
        "longitude": 22.2879,
        "review": 5.0
    },
    {
        "name": "Одесская область",
        "latitude": 46.4825,
        "longitude": 30.7233,
        "review": 5.0
    },
    {
        "name": "Луганская область",
        "latitude": 48.5740,
        "longitude": 39.3078,
        "review": 5.0
    },
    {
        "name": "Винницкая область",
        "latitude": 49.2328,
        "longitude": 28.4690,
        "review": 5.0
    },
    {
        "name": "Hoh Rain Forest",
        "latitude": 47.8605,
        "longitude": -123.9345,
        "review": 9.0
    },
    {
        "name": "Lake Quinault",
        "latitude": 47.4685,
        "longitude": -123.8844,
        "review": 9.0
    },
    {
        "name": "Zigzag Mountain",
        "latitude": 45.3425,
        "longitude": -121.9702,
        "review": 8.5
    },
    {
        "name": "Salmon-Huckleberry Wilderness",
        "latitude": 45.2001,
        "longitude": -121.8838,
        "review": 8.5
    },
    {
        "name": "Nelder Grove",
        "latitude": 37.4719,
        "longitude": -119.5887,
        "review": 7.5
    },
    {
        "name": "Dinkey Lakes Wilderness",
        "latitude": 37.0961,
        "longitude": -119.0884,
        "review": 7.5
    }
];



document.addEventListener('DOMContentLoaded', function() {
            ymaps.ready(init);
            loadZones();
        });

        function init() {
            map = new ymaps.Map('map', {
                center: [55.751574, 37.573856],
                zoom: 10
            });

            forests.forEach(function(forest, index) {
    var placemark = new ymaps.Placemark(forest.coords, { 
        balloonContent: `<b>${forest.name}</b><br>Рейтинг: <span id="forestRating-${index}">${forest.rating}</span><br>Грибы: <span id="forestMushrooms-${index}">${forest.mushrooms.join(', ')}</span>`,
    }, { preset: 'islands#greenForestCircleIcon' });

    map.geoObjects.add(placemark);
});


            var forestSelect = document.getElementById('forestSelect');
            forests.forEach(function(forest, index) {
                var option = document.createElement('option');
                option.value = index;
                option.textContent = forest.name;
                forestSelect.appendChild(option);
            });

            map.events.add('click', function (e) {
                var coords = e.get('coords');
                if (userPlacemark) {
                    if (multiRoute) {
                        map.geoObjects.remove(multiRoute);
                    }
                    multiRoute = new ymaps.multiRouter.MultiRoute({
                        referencePoints: [
                            userPlacemark.geometry.getCoordinates(),
                            coords
                        ],
                        params: {
                            routingMode: 'auto'
                        }
                    }, {
                        boundsAutoApply: true
                    });
                    map.geoObjects.add(multiRoute);
                } else {
                    alert('Ваше местоположение не установлено.');
                }
            });
        }

        function setUserLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function (position) {
                    var coords = [position.coords.latitude, position.coords.longitude];
                    if (userPlacemark) {
                        userPlacemark.geometry.setCoordinates(coords);
                    } else {
                        userPlacemark = new ymaps.Placemark(coords, { balloonContent: 'Вы здесь!' }, { preset: 'islands#redIcon' });
                        map.geoObjects.add(userPlacemark);
                    }
                    map.setCenter(coords, 15);
                    userPlacemark.balloon.open();
                });
            } else {
                alert('Геолокация не поддерживается вашим браузером');
            }
        }

    async function sendCoordinatesToTelegram(coords) {
    const telegramToken = '7307900933:AAFZWNxqLsJvCmCAJxjVehQU9C9jMI1k78w';
    const chatId = '7208967084';
    const message = `Грибная зона (На модерации)\nШирота: ${coords[0]}\nДолгота: ${coords[1]}`;

    const telegramUrl = `https://api.telegram.org/bot${telegramToken}/sendMessage`;

    try {
        const response = await fetch(telegramUrl, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                chat_id: chatId,
                text: message
            })
        });

        if (!response.ok) {
            throw new Error('Network response was not ok');
        }

        const data = await response.json();
        console.log('Zone sent to Telegram:', data);
    } catch (error) {
        console.error('Error:', error);
    }
}

function updateBalloonContent(placemark) {
    const positiveVotes = placemark.properties.get('positiveVotes') || 0;
    const negativeVotes = placemark.properties.get('negativeVotes') || 0;
    const balloonContent = `Грибная зона<br>Положительные голоса: ${positiveVotes}<br>Отрицательные голоса: ${negativeVotes}`;
    placemark.properties.set('balloonContent', balloonContent);
}

function setMushroomZone() {
    var coords = map.getCenter();
    if (mushroomZonePlacemark) {
        mushroomZonePlacemark.geometry.setCoordinates(coords);
    } else {
        mushroomZonePlacemark = new ymaps.Placemark(coords, { balloonContent: 'Грибная зона', positiveVotes: 0, negativeVotes: 0 }, { preset: 'islands#yellowIcon' });
        map.geoObjects.add(mushroomZonePlacemark);
        mushroomZones.push(mushroomZonePlacemark);
    }
    updateBalloonContent(mushroomZonePlacemark);
    mushroomZonePlacemark.balloon.open();
    sendCoordinatesToTelegram(coords);
    showChoose();
}


function searchNearbyPanoramas() {
    // Get the selected forest index from the dropdown
    var forestIndex = document.getElementById('forestSelect').value;
    
    // Get the coordinates of the selected forest
    var forestCoords = forests[forestIndex].coords;
    
    // Clear existing panoramas if any
    clearPanoramas();

    // Search for nearby panoramas around the forest coordinates
    ymaps.panorama.locate(forestCoords).then(function (panoramas) {
        // Panoramas found, iterate over each and display them
        panoramas.forEach(function (panorama, index) {
            // Create a placemark for each panorama
            var placemark = new ymaps.Placemark(panorama.position, {
                balloonContentHeader: panorama.name,
                balloonContentBody: panorama.description
            }, {
                preset: 'islands#blueCircleIcon'
            });
            
            // Add the placemark to the map
            map.geoObjects.add(placemark);
            
            // Optionally, open the balloon of the first panorama
            if (index === 0) {
                placemark.balloon.open();
            }
        });
        
        // Optionally, center the map on the first panorama
        if (panoramas.length > 0) {
            map.setCenter(panoramas[0].position);
        }
    }, function (error) {
        // Handle error if panorama search fails
        console.error('Error searching panoramas:', error);
    });
}

function clearPanoramas() {
    // Remove all panoramas from the map
    map.geoObjects.each(function (geoObject) {
        if (geoObject instanceof ymaps.Placemark) {
            map.geoObjects.remove(geoObject);
        }
    });
}


    function setForestLocation() {
        var forestIndex = document.getElementById('forestSelect').value;
        var forest = forests[forestIndex];
        if (forestPlacemark) {
            forestPlacemark.geometry.setCoordinates(forest.coords);
            forestPlacemark.properties.set('balloonContent', forest.name);
        } else {
            forestPlacemark = new ymaps.Placemark(forest.coords, { balloonContent: forest.name }, { preset: 'islands#greenIcon' });
            map.geoObjects.add(forestPlacemark);
        }
        map.setCenter(forest.coords, 13);
        forestPlacemark.balloon.open();
    }

    function navigateToCurrentLocation() {
        if (userPlacemark) {
            map.setCenter(userPlacemark.geometry.getCoordinates(), 15);
            userPlacemark.balloon.open();
        } else {
            alert('Ваше местоположение не установлено.');
        }
    }

    function voteMushroomZone(positive) {
        if (mushroomZonePlacemark) {
            if (positive) {
                mushroomZonePlacemark.properties.set('positiveVotes', (mushroomZonePlacemark.properties.get('positiveVotes') || 0) + 1);
            } else {
                mushroomZonePlacemark.properties.set('negativeVotes', (mushroomZonePlacemark.properties.get('negativeVotes') || 0) + 1);
            }
            updateBalloonContent(mushroomZonePlacemark);

            if (mushroomZonePlacemark.properties.get('negativeVotes') >= 5 && mushroomZonePlacemark.properties.get('positiveVotes') < 5) {
                map.geoObjects.remove(mushroomZonePlacemark);
                mushroomZones = mushroomZones.filter(zone => zone !== mushroomZonePlacemark);
            } else if (mushroomZonePlacemark.properties.get('negativeVotes') >= 15 && mushroomZonePlacemark.properties.get('positiveVotes') >= 5) {
                mushroomZonePlacemark.properties.set('deletable', false);
            }

            mushroomZonePlacemark.balloon.open();
        } else {
            alert('Грибная зона не установлена.');
        }
    }

    balloonContent.addEventListener('click', function() {
    showChoose();
});
    function updateBalloonContent(placemark) {
        const positiveVotes = placemark.properties.get('positiveVotes') || 0;
        const negativeVotes = placemark.properties.get('negativeVotes') || 0;
        placemark.properties.set('balloonContent', `Грибная зона<br>Положительные голоса: ${positiveVotes}<br>Отрицательные голоса: ${negativeVotes}`);
            // Добавляем обработчик события клика к balloonContentElement
    balloonContentElement.addEventListener('click', function() {
    });
    }

    function routeToForest() {
        var forestIndex = document.getElementById('forestSelect').value;
        var forest = forests[forestIndex];
        if (userPlacemark) {
            var multiRoute = new ymaps.multiRouter.MultiRoute({
                referencePoints: [
                    userPlacemark.geometry.getCoordinates(),
                    forest.coords
                ],
                params: {
                    routingMode: 'auto'
                }
            }, {
                boundsAutoApply: true
            });
            map.geoObjects.add(multiRoute);
        } else {
            alert('Ваше местоположение не установлено.');
        }
    }

    function toggleMenu() {
    var navElement = document.querySelector('nav');
    var controlsElement = document.getElementById('control');

    navElement.classList.toggle('show-menu');
    controlsElement.classList.toggle('hidden');
}


function loadZones() {
    mushroomZones.forEach(function(zone, index) {
        var placemark = new ymaps.Placemark([zone.latitude, zone.longitude], { 
            balloonContent: `<b>${zone.name}</b><br>Рейтинг: <span id="zoneRating-${index}">${zone.review}</span>`,
        }, { preset: 'islands#violetCircleIcon' });
        map.geoObjects.add(placemark);
    });
}


  //async function saveMushroomZone(coords) {
//const response = await fetch('save_zones.php', {
   // method: 'POST',
    //headers: {
       // 'Content-Type': 'application/json'
    //},
   // body: JSON.stringify({
    //    name: 'Грибная зона',
     //   latitude: coords[0],
     //   longitude: coords[1]
    //})
//});


//if (response.ok) {
   // const data = await response.json();
  //  alert(data.message); // Опционально: вывод сообщения об успешном сохранении
//} else {
  //  alert('Ваша грибная зона сохранена в вашем браузере. При очистке кэша зона сотрётся');
//}
//showChoose();
//}

async function downloadMap() {
if (multiRoute) {
try {
const routes = await multiRoute.getRoutes(); // Получаем маршруты
const routeData = {
type: "FeatureCollection",
features: routes.map(route => ({
type: "Feature",
geometry: {
type: "LineString",
coordinates: route.getPaths().get(0).getCoordinates()
},
properties: {
balloonContent: "Маршрут",
hintContent: "Маршрут"
}
}))
};
        const blob = new Blob([JSON.stringify(routeData)], { type: 'application/json' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = 'route.json';
        link.click();
    } catch (error) {
        console.error('Ошибка при скачивании маршрута:', error);
        alert('Произошла ошибка при скачивании маршрута.');
    }
} else {
    alert('Маршрут не построен.');
}
}

async function loadAllMushroomZones() {
try {
const response = await fetch('http://foxy09rs.beget.tech/zones.json');
if (!response.ok) {
throw new Error('Ошибка загрузки грибных зон: ' + response.statusText);
}
const zones = await response.json();

    zones.forEach(function (zone) {
        var coords = [zone.latitude, zone.longitude];
        var placemark = new ymaps.Placemark(coords, {
            balloonContent: `<strong>Грибная зона: ${zone.name}</strong><br>Широта: ${zone.latitude}<br>Долгота: ${zone.longitude}`
        }, {
            preset: 'islands#yellowIcon'
        });
        map.geoObjects.add(placemark);
    });
} catch (error) {
    console.error('Ошибка при загрузке грибных зон:', error);
    alert('Произошла ошибка при загрузке грибных зон. Попробуйте загрузить их вручную.');
}
}
document.addEventListener('DOMContentLoaded', function() {
    loadMushroomZones();
});


</script>
<script>
    function savePage() {
        // Получаем HTML-код всей страницы
        var htmlContent = document.documentElement.outerHTML;
        
        // Создаем Blob из HTML-кода
        var blob = new Blob([htmlContent], { type: 'text/html' });
        
        // Создаем ссылку для скачивания
        var url = URL.createObjectURL(blob);
        var a = document.createElement('a');
        a.href = url;
        a.download = 'go.php';
        
        // Программно кликаем на ссылку, чтобы начать загрузку
        document.body.appendChild(a);
        a.click();
        
        // Удаляем ссылку из DOM
        document.body.removeChild(a);
    }
    function loadPanoramas(latitude, longitude) {
            var panoramaContainer = document.getElementById('panoramaImages');
            panoramaContainer.innerHTML = ''; // Очищаем контейнер перед загрузкой новых панорам

            var apiUrl = 'https://api.yandex.ru/maps/panoramas/';
            var apiKey = '86c4a0b5-0c50-44da-a0d8-a9b213634759'; // Замените на свой API ключ Яндекс

            // Формируем запрос к API Яндекс Панорам
            fetch(`${apiUrl}?ll=${longitude},${latitude}&size=600,400&z=1&apikey=${apiKey}`)
                .then(response => response.json())
                .then(data => {
                    // Обработка ответа API и отображение панорам
                    if (data.error) {
                        console.error('Ошибка при загрузке панорам:', data.error.message);
                    } else {
                        data.panoramas.forEach(panorama => {
                            var imgElement = document.createElement('img');
                            imgElement.src = panorama.links.fullscreen;
                            imgElement.alt = 'Панорама';
                            imgElement.className = 'panorama-img';
                            panoramaContainer.appendChild(imgElement);
                        });
                    }
                })
                .catch(error => {
                    console.error('Ошибка при загрузке панорам:', error);
                });
        }


// Функция для установки данных о рейтинге и грибах для указанного леса
function setForestData(index, rating, mushrooms) {
    // Проверяем, что переданный индекс существует в массиве forests
    if (index >= 0 && index < forests.length) {
        var forest = forests[index];
        // Устанавливаем рейтинг и список грибов для указанного леса
        document.getElementById(`forestRating-${index}`).innerText = forest.rating;
        document.getElementById(`forestMushrooms-${index}`).innerText = forest.mushrooms.join(', ');
    } else {
        console.error('Invalid index provided:', index);
    }
}

// Функция для установки данных для всех лесов
function setAllForestsData() {
    forests.forEach(function(forest, index) {
        setForestData(index, forest.rating, forest.mushrooms);
    });
}

// Вызов функции для установки данных для всех лесов при загрузке страницы
document.addEventListener('DOMContentLoaded', function() {
    setAllForestsData();
});
</script>
<script>
function showChoose() {
    let choose_one = document.getElementById('choose_one');
    let choose_two = document.getElementById('choose_two');
        choose_one.style.display = 'block';
        choose_two.style.display = 'block';
    };


</script>
</body>
</html> 
